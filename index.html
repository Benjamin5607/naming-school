<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Naming School</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
  <!-- Puter.js: Free AI (no key needed) - Updated 2025 -->
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
    h1 { font-family: 'Anton', sans-serif; color: #ff4500; }
    #preview { max-width: 100%; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); margin: 20px auto; }
    canvas { max-width: 100%; border-radius: 20px; }
    button { padding: 10px 20px; font-size: 18px; margin: 10px; background: #ff4500; color: white; border: none; border-radius: 10px; }
    input { margin: 20px; }
    #loading { color: #ff4500; font-weight: bold; display: none; }
  </style>
</head>
<body>
  <h1>Naming School ðŸŽ“</h1>
  <p>Upload an image! AI will generate a hilarious English office joke caption and turn it into a sticker ðŸ˜†</p>
  
  <input type="file" id="imageLoader" accept="image/*">
  <p id="loading">AI trying multiple models to create an epic office joke... ðŸ¤¯</p>
  
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="preview" src="" alt="Sticker Preview" style="display:none;">
  
  <br>
  <button id="downloadBtn" style="display:none;">Download Sticker ðŸ“¥</button>

  <script>
    // Latest fast/reliable models first (Dec 2025 update: Grok 4.1 fast added!)
    const modelList = [
      "gpt-5-nano",
      "x-ai/grok-4.1-fast",       // Super fast Grok!
      "gpt-4o-mini",
      "mistralai/mistral-small-3.2",
      "x-ai/grok-3-mini",
      "claude-3.5-sonnet",
      "gemini-1.5-flash",
      "deepseek/deepseek-r1"
    ];

    // Fallback jokes if all else fails
    const fallbackJokes = [
      "WHEN THE MEETING COULD'VE BEEN AN EMAIL",
      "MONDAY MORNING WITHOUT COFFEE",
      "THIS SPREADSHEET IS MY LIFE NOW",
      "PRINTER JAMMED AGAIN... SHOCKING",
      "BOSS: 'PER MY LAST EMAIL'",
      "REPLY ALL APOCALYPSE",
      "COFFEE: MY ONLY COWORKER WHO UNDERSTANDS",
      "EXCEL JUST CRASHED MY DREAMS",
      "ZOOM BACKGROUND FAIL INCOMING",
      "LET'S CIRCLE BACK TO THAT... FOREVER"
    ];

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const preview = document.getElementById('preview');
    const downloadBtn = document.getElementById('downloadBtn');
    const loading = document.getElementById('loading');

    document.getElementById('imageLoader').addEventListener('change', async function(e) {
      if (e.target.files.length == 0) return;
      
      const file = e.target.files[0];
      const reader = new FileReader();
      
      reader.onload = async function(event) {
        const img = new Image();
        img.onload = async function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          loading.style.display = 'block';
          
          let title = null;
          
          for (const model of modelList) {
            try {
              const resp = await puter.ai.chat(
                "Generate ONE super funny, absurd English office joke meme caption in ALL CAPS. Relatable to office life: endless meetings, bosses, coffee, spreadsheets, printers, Mondays etc. Short, punchy, classic meme style. No explanation, just the caption!",
                { model: model }
              );
              title = resp;  // Puter.js returns string directly in many cases
              if (title && typeof title === 'string' && title.trim().length > 0) {
                console.log(`Success with model: ${model}`);
                break;
              }
            } catch (err) {
              console.warn(`Model ${model} failed:`, err);
            }
          }
          
          if (!title || title.trim().length === 0) {
            title = fallbackJokes[Math.floor(Math.random() * fallbackJokes.length)];
          }
          
          loading.style.display = 'none';
          
          ctx.font = 'bold ' + Math.min(canvas.width / 8, 80) + 'px Anton';
          ctx.fillStyle = 'white';
          ctx.strokeStyle = 'black';
          ctx.lineWidth = Math.min(canvas.width / 50, 10);
          ctx.textAlign = 'center';
          ctx.textBaseline = 'top';
          
          wrapText(ctx, title.toUpperCase(), canvas.width / 2, canvas.height * 0.05, canvas.width * 0.9, Math.min(canvas.width / 10, 100));
          
          preview.src = canvas.toDataURL('image/png');
          preview.style.display = 'block';
          downloadBtn.style.display = 'block';
          
          downloadBtn.onclick = function() {
            const link = document.createElement('a');
            link.download = 'office-joke-sticker.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
          };
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function wrapText(context, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      let currentY = y;

      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = context.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > maxWidth && n > 0) {
          context.strokeText(line, x, currentY);
          context.fillText(line, x, currentY);
          line = words[n] + ' ';
          currentY += lineHeight;
        } else {
          line = testLine;
        }
      }
      context.strokeText(line, x, currentY);
      context.fillText(line, x, currentY);
    }
  </script>
</body>
</html>
